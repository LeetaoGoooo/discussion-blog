<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生成器(generator) - Leetao</title>
    <meta name="description" content="






# What is *yield*

*yield* 关键字返回生成器( generator )的数据。

&gt;The heart of a generator function is the yield keyword. In its simplest fo...">
    
    <link rel="icon" href="/favicon.svg" type="image/x-icon">
    
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/chroma.css">
    <link rel="alternate" type="application/rss+xml" href="/rss.xml" title="RSS Feed">
</head>
<body class="container">
    <header class="site-header">
        <div class="site-header__left">
            <a href="/" class="site-title">Leetao</a>
            
            <p class="site-description">写有趣的代码，做有趣的事</p>
            
        </div>
        <div class="site-header__right">
            <nav class="site-nav">
                <a href="/">Home</a>
                <a href="/tags/">Tags</a>
                <a href="/about/">About</a>
                <button class="theme-toggle" id="theme-toggle">
                    <svg class="theme-icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </nav>
        </div>
    </header>
    
    <main>
        <article class="post">
            <header class="post-header">
                <h1 class="post-title">生成器(generator)</h1>
                <p class="post-meta">
                    By LeetaoGoooo on July 16, 2023
                </p>
            </header>
            
            <div class="post-content">
                <h1 id="what-is-yield">What is <em>yield</em></h1>

<p><em>yield</em> 关键字返回生成器( generator )的数据。</p>

<blockquote>
<p>The heart of a generator function is the yield keyword. In its simplest form, a yield statement looks much like a return statement, except that instead of stopping execution of the function and returning, yield instead provides a value to the code looping over the generator and pauses execution of the generator function.</p>
</blockquote>

<h1 id="what-is-a-generator-function">What is a generator function</h1>

<p>生成器函数是一种更为紧凑和有效编写迭代器的方法。它允许你定义一个函数,在循环时计算和返回结果。</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="nx">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$key</span><span class="s2"> =&gt; </span><span class="si">$value</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre>
<p>将会有如下的输出:</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="mi">0</span> <span class="o">=&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="nx">…</span>
</span></span><span class="line"><span class="cl"><span class="mi">9</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</span></span></code></pre>
<p>你同样可以控制在 <em>foreach</em> 中的 $key,通过如下的方式:</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="k">yield</span> <span class="nv">$someKey</span> <span class="o">=&gt;</span> <span class="nv">$someValue</span><span class="p">;</span>
</span></span></code></pre>
<p>在生成器函数中,someKey 是你想要出现的 key,someVaue 则是 val 中的值。在例子中,它则是 i</p>

<h1 id="what-s-the-difference-to-normal-functions">What's the difference to normal functions?</h1>

<p>你可能会觉得我们用 PHP 原生的 range 函数同样也可以实现一样的输出，这点没错，但是最大的区别是这两种方式的输出是如何得到的。</p>

<p>当我们使用 range 的时候,它在内存中将整个数组创建出来,并将整个数组交给 foreach 去遍历。换句话说，foreach 将自己来操作整个数组。range 函数和 foreach 函数只交互了一次。想想我们接收邮件包裹，派送人员把包裹给你了，然后就离开了，剩下的就需要你自己去打开包裹并发现包裹里装的是什么了。</p>

<p>当我们使用生成函数时，PHP将进入函数并执行它，直到它满足结束或遇到 yield 关键字。 当它遇到 yield 时，它将返回当时值的任何值到外部循环。 然后它回到生成器，并继续从它产生的地方开始。 由于你的 xrange 拥有一个 for 循环，它将执行并产生，直到达到$max。想象一下 foreach 和生成器打乒乓球的场景。</p>

<h1 id="why-do-i-need-that">Why do I need that?</h1>

<p>很显然，生成器可以被应用于内存有限的场景中。取决于你的环境而言，如果做一个 range(0,100000)循环可能导致你的脚本严重错误的话，使用生成器仍旧可以很好的运行。或者就如维基百科所言:</p>

<blockquote>
<p>Because generators compute their yielded values only on demand, they are useful for representing sequences that would be expensive or impossible to compute at once. These include e.g. infinite sequences and live data streams.</p>
</blockquote>

<p>生成器应该很快。 但请记住，当我们谈论很快时，我们通常是在非常少的场景中讨论。 所以在你现在跑掉并更改所有代码以使用生成器之前，请做一个基准测试，看看它在哪里有意义。</p>

<p>生成器的另一个用例是异步协同程序。 yield关键字不仅返回值，而且还接受它们</p>

<h1 id="补充">补充</h1>

<p>PHP 的生成器不能满足所有迭代操作的需求，因为如果不查询，生成器永远不知道下一个要迭代的值是什么，在生成器中无法后退或者快进。生成器还是一次性的，无法多次迭代同一个生成器。不过，如果需要的，可以重建或者克隆生成器。</p>

<h1 id="待测试">待测试</h1>

<p>未完待续，通过生成器是否能够解决大文件加载问题，已经是否能够提高读取速度问题。</p>

<p>整理翻译自:
<a href="https://stackoverflow.com/questions/17483806/what-does-yield-mean-in-php">What does yield mean in PHP?</a></p>

            </div>
            
            <div class="tag-list">
                
            </div>
            
            <div class="giscus">
                <script src="https://giscus.app/client.js"
                    data-repo="leetaogoooo/discussion-blog"
                    data-repo-id="R_kgDOIOm9Yg"
                    data-mapping="number"
                    data-term="208"
                    data-reactions-enabled="1"
                    data-emit-metadata="0"
                    data-input-position="top"
                    data-theme="light"
                    data-lang="en"
                    crossorigin="anonymous"
                    async>
                </script>
            </div>
            
        </article>
    </main>
    
    <footer>
        <p>&copy; Leetao. All rights reserved.</p>
    </footer>
    
    <script src="/js/theme-toggle.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            const giscusScript = document.querySelector('script[src^="https://giscus.app/client.js"]');
            const setGiscusTheme = (theme) => {
                if (giscusScript) {
                    const message = { setConfig: { theme: theme } };
                    const iframe = document.querySelector('.giscus-frame');
                    if (iframe) {
                        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
                    }
                }
            };
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            setGiscusTheme(currentTheme);
            new MutationObserver((mutations) => {
                mutations.forEach(mutation => {
                    if (mutation.attributeName === 'data-theme') {
                        setGiscusTheme(mutation.target.getAttribute('data-theme'));
                    }
                });
            }).observe(document.documentElement, { attributes: true });


            
            function initCopyButtons() {
                document.querySelectorAll('pre.chroma').forEach((pre) => {
                    
                    const existingButton = pre.querySelector('.copy-button');
                    if (existingButton) {
                        existingButton.remove();
                    }
                    
                    const button = document.createElement('button');
                    button.className = 'copy-button';
                    button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                    
                    pre.style.position = 'relative';
                    pre.appendChild(button);
                    
                    button.addEventListener('click', () => {
                        const code = pre.querySelector('code');
                        if (code) {
                            navigator.clipboard.writeText(code.innerText).then(() => {
                                button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"></path></svg>';
                                setTimeout(() => {
                                    button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                                }, 2000);
                            });
                        }
                    });
                });
                const button = document.createElement('button');
                button.className = 'copy-button';
                button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                
                pre.style.position = 'relative';
                pre.appendChild(button);
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code');
                    if (code) {
                        navigator.clipboard.writeText(code.innerText).then(() => {
                            button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"></path></svg>';
                            setTimeout(() => {
                                button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                            }, 2000);
                        });
                    }
                });
            }
            
            
            initCopyButtons();
            
            
            document.addEventListener('themeChanged', () => {
                initCopyButtons();
            });
        });
    </script>
</body>
</html>