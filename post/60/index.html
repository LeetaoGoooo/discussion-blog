<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&#39;pep 544 Protocols: Structural subtyping (static duck typing)&#39; - Leetao</title>
    <meta name="description" content="# å‰è¨€

åœ¨ [PEP 484](https://www.python.org/dev/peps/pep-0484)  ä¸­å¼•å…¥çš„ Typing hints (ç±»å‹æç¤º) å¯ä»¥ç”¨æ¥ä¸ºé™æ€ç±»å‹æ£€æŸ¥å™¨å’Œå…¶ä»–ç¬¬ä¸‰æ...">
    
    <link rel="icon" href="/favicon.svg" type="image/x-icon">
    
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
</head>
<body>
    <header>
        <h1><a href="/">Leetao</a></h1>
        
        <p class="site-description">å†™æœ‰è¶£çš„ä»£ç ï¼Œåšæœ‰è¶£çš„äº‹</p>
        
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/tags/">Tags</a></li>
                <li><a href="/about/">About</a></li>
                <li><button class="theme-toggle" id="theme-toggle">
                    <svg class="theme-icon" viewBox="0 0 24 24" width="16" height="16">
                        <path d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/>
                    </svg>
                    Theme
                </button></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <article class="post">
            <h1>&#39;pep 544 Protocols: Structural subtyping (static duck typing)&#39;</h1>
            <p class="meta">
                By LeetaoGoooo on July 16, 2023
            </p>
            
            <div class="content">
                <h1>å‰è¨€</h1>

<p>åœ¨ <a href="https://www.python.org/dev/peps/pep-0484">PEP 484</a>  ä¸­å¼•å…¥çš„ Typing hints (ç±»å‹æç¤º) å¯ä»¥ç”¨æ¥ä¸ºé™æ€ç±»å‹æ£€æŸ¥å™¨å’Œå…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·æŒ‡å®šç±»å‹å…ƒæ•°æ®ã€‚ä½†æ˜¯åœ¨ï¼Œ<a href="https://www.python.org/dev/peps/pep-0484">PEP 484</a>  åªæŒ‡å®šäº†åä¹‰å­ç±»å‹çš„è¯­ä¹‰ã€‚åœ¨è¿™ä¸ª <a href="https://www.python.org/dev/peps/pep-0544/">PEP 544</a> ä¸­ï¼ŒæŒ‡å®šäº†åè®®ç±»çš„é™æ€å’Œè¿è¡Œæ—¶è¯­ä¹‰ï¼Œè¿™å°†ä¸ºç»“æ„æ€§å­ç±»å‹ï¼ˆé™æ€é¸­å­ç±»å‹ï¼‰æä¾›ä¸€ä¸ªæ”¯æŒã€‚</p>

<h2>ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹(Duck Typing)ï¼Ÿ</h2>

<blockquote>
<p>If it walks like a duck and it quacks like a duck, then it must be a duckã€‚</p>
</blockquote>

<p>ç®€å•åœ°è¯´ï¼Œâ€å¦‚æœå®ƒèµ°è·¯åƒé¸­å­ï¼Œå«èµ·æ¥åƒé¸­å­ï¼Œé‚£å®ƒä¸€å®šæ˜¯é¸­å­â€œã€‚</p>

<p>åœ¨ç¼–ç¨‹ä¸­è¿™å°±æ„å‘³ç€å½“æˆ‘ä»¬ç¼–å†™æ¥æ”¶ç‰¹å®šè¾“å…¥çš„å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒè¯¥å‡½æ•°è¾“å…¥çš„è¡Œä¸ºã€å±æ€§ï¼Œè€Œä¸æ˜¯è¯¥å‡½æ•°è¾“å…¥çš„æ˜¾å¼ç±»å‹ã€‚</p>

<blockquote>
<p>ä¾‹å¦‚ï¼Œåœ¨ä¸ä½¿ç”¨é¸­å­ç±»å‹çš„è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªç±»å‹ä¸º&rdquo;é¸­å­&rdquo;çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„&rdquo;èµ°&rdquo;å’Œ&rdquo;å«&rdquo;æ–¹æ³•ã€‚åœ¨ä½¿ç”¨é¸­å­ç±»å‹çš„è¯­è¨€ä¸­ï¼Œè¿™æ ·çš„ä¸€ä¸ªå‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„&rdquo;èµ°&rdquo;å’Œ&rdquo;å«&rdquo;æ–¹æ³•ã€‚â€” ç™¾åº¦ç™¾ç§‘</p>
</blockquote>

<p>é‚£ä¹ˆå¦‚ä½•åœ¨ Python ä¸­å®ç°â€œé¸­å­ç±»å‹â€å‘¢ï¼Ÿ</p>

<h1>é¸­å­ç±»å‹</h1>

<p>ç°åœ¨æœ‰è¿™æ ·å­åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªå‡½æ•°å»è®¡ç®—ä¸€ä¸ªæ‹¥æœ‰è¾¹é•¿(len_side)çš„ç‰©ä½“çš„å‘¨é•¿ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-sql">function calcute_circumference(shape):
		circumference = 0 
		for side in shape.len_side: /// éå†è¾¹é•¿
			circumference += side
		return circumference /// å‘¨é•¿
</code></pre>

<p>ä»ä¼ªä»£ç ä¸éš¾çœ‹å‡ºï¼Œæˆ‘ä»¬ä¸å…³å¿ƒæ˜¯ä»€ä¹ˆçš„ç‰©ä½“ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯è¿™ä¸ªç‰©ä½“å¯ä»¥æœ‰ä¸€ä¸ª len_sideï¼ˆåˆ—è¡¨ï¼‰ å­—æ®µå°±å¯ä»¥äº†ã€‚</p>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å€Ÿç”± <code>Protocol</code> å»å®ç°å®ƒã€‚</p>

<pre><code class="language-python">from typing import Protocol

class ObjWithSideLen(Protocol):
	side_len: list

def calcute_circumference(shape: ObjWithSideLen):
	circumference = 0 
	for side in shape.side_len:
		circumference += side
	return circumference
</code></pre>

<p>ä»ä¸Šé¢çš„ä¾‹å­ä¸éš¾çœ‹å‡º <code>Protocol</code> æœ‰ç‚¹ç±»ä¼¼ Java ä¸­çš„æ¥å£ï¼Œåªéœ€è¦åœ¨å‡½æ•°ä¸Šä½¿ç”¨å®ƒï¼Œå¹¶ä¸éœ€è¦å»å…³æ³¨è¾“å…¥çš„å‚æ•°çš„å…·ä½“ç±»å‹ã€‚</p>

<h1>æ³›å‹</h1>

<p>æˆ‘ä»¬è¿˜å¯ä»¥é…åˆä½¿ç”¨ <code>typing</code> ä¸­çš„ <code>TypeVar</code> å®ç°æ³›å‹å‚æ•°åŒ–ï¼Œè®©æˆ‘ä»¬çš„å‡½æ•°æ›´åŠ æŠ½è±¡åŒ–ï¼Œåªè¦ç¬¦åˆåè®®ï¼Œæ— è®ºä»€ä¹ˆç±»å‹çš„è¾“å…¥éƒ½å¯ä»¥ã€‚</p>

<pre><code class="language-python">from typing import Protocol

class ObjWithSideLen(Protocol):
	side_len: list

T = TypeVar('T', bound=ObjWithSideLen)

def calcute_circumference(shape: T) -&gt; T:
	circumference = 0 
	for side in shape.side_len:
		circumference += side
	shape.circumference = circumference
	return shape
</code></pre>

<h1>å»¶ä¼¸</h1>

<p>ä¸Šè¿°çš„ä¾‹å­éƒ½å¯ä»¥å€Ÿç”± Python ä¸­çš„ ABCs å»å®ç°çš„ï¼Œä½†æ˜¯ä¸¤è€…çš„ä¾§é‡ç‚¹æœ‰æ‰€ä¸åŒï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œè®©æˆ‘ä»¬ä»”ç»†å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…çš„çš„åŒºåˆ«ã€‚</p>

<ul>
<li><p>å‚è€ƒæ–‡ç« </p>

<p><a href="https://docs.python.org/zh-cn/3/library/typing.html">python-typing</a></p>

<p><a href="https://www.daan.fyi/writings/python-protocols">Static Duck Typing in Python with Protocols</a></p>

<p><a href="https://www.python.org/dev/peps/pep-0544/">PEP 544</a></p></li>
</ul>

            </div>
            
            <div class="tags">
                
            </div>
            
            <div class="giscus">
                <script src="https://giscus.app/client.js"
                    data-repo="leetaogoooo/discussion-blog"
                    data-repo-id="R_kgDOIOm9Yg"
                    data-mapping="number"
                    data-term="60"
                    data-reactions-enabled="1"
                    data-emit-metadata="0"
                    data-input-position="top"
                    data-theme="preferred_color_scheme"
                    data-lang="zh-CN"
                    data-loading="lazy"
                    crossorigin="anonymous"
                    async>
                </script>
            </div>
            
            <div class="back-link">
                <a href="/">&larr; Back to posts</a>
            </div>
        </article>
    </main>
    
    <footer>
        <p>&copy; Leetao. All rights reserved.</p>
    </footer>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="/js/theme-toggle.js"></script>
    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            
            const pres = document.querySelectorAll('pre');
            pres.forEach(pre => {
                
                const button = document.createElement('button');
                button.className = 'copy-button';
                button.textContent = 'Copy';
                
                
                pre.appendChild(button);
                
                
                button.addEventListener('click', () => {
                    
                    const code = pre.querySelector('code');
                    const text = code ? code.textContent : pre.textContent;
                    
                    
                    navigator.clipboard.writeText(text).then(() => {
                        
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        
                        
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 3000);
                    }).catch(err => {
                        console.error('Failed to copy: ', err);
                    });
                });
            });
        });
    </script>
</body>
</html>