<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How To Structure Large Flask Applications - Leetao</title>
    <meta name="description" content="







&gt;整理翻译自[How To Structure Large Flask Applications](https://www.digitalocean.com/community/tutorials/how-to-structure-large-flask-applications)
...">
    
    <link rel="icon" href="/favicon.svg" type="image/x-icon">
    
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/chroma.css">
    <link rel="alternate" type="application/rss+xml" href="/rss.xml" title="RSS Feed">
</head>
<body class="container">
    <header class="site-header">
        <div class="site-header__left">
            <a href="/" class="site-title">Leetao</a>
            
            <p class="site-description">写有趣的代码，做有趣的事</p>
            
        </div>
        <div class="site-header__right">
            <nav class="site-nav">
                <a href="/">Home</a>
                <a href="/tags/">Tags</a>
                <a href="/about/">About</a>
                <button class="theme-toggle" id="theme-toggle">
                    <svg class="theme-icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </nav>
        </div>
    </header>
    
    <main>
        <article class="post">
            <header class="post-header">
                <h1 class="post-title">How To Structure Large Flask Applications</h1>
                <p class="post-meta">
                    By LeetaoGoooo on July 16, 2023
                </p>
            </header>
            
            <div class="post-content">
                <blockquote>
<p>整理翻译自<a href="https://www.digitalocean.com/community/tutorials/how-to-structure-large-flask-applications">How To Structure Large Flask Applications</a></p>
</blockquote>

<h1 id="介绍">介绍</h1>

<p>其实已经有许多关于如何组织架构 Python Web 应用的方法和约定。尽管现在有些框架本身承载了一些工具(脚手架)从而可以达到实现自动化和降低任务难度的效果,但是究根结底几乎所有的解决方案都是依赖于打包/模块化应用作为代码块从而达到分发到相关的文件和文件夹的目的。</p>

<p>最小的 web 应用开发框架 Flask 有着它特有的(工具)-blueprints。</p>

<p>在这篇数码海洋的文章里,我们将会了解到如何使用 Flask 的 blueprints 来创建一个应用目录和组织架构它从而使其变成可重用的组件。这些将会给你的维护和组件的开发带来巨大的好处和便捷。</p>

<h2 id="学术表">学术表</h2>

<ol>
<li>Flask：最小的应用开发框架</li>
<li>关于我们在这篇文章的选择</li>
<li>准备Flask系统

<ol>
<li>准备操作系统</li>
<li>安装Python,pip以及virtualenv</li>
</ol></li>
<li>组织架构应用的目录

<ol>
<li>创建应用目录</li>
<li>创建虚拟环境</li>
<li>创建应用文件</li>
<li>安装 Flask</li>
</ol></li>
<li>使用模块和 Blueprints(组件)

<ol>
<li>模块基础</li>
<li>模块模板</li>
</ol></li>
<li>创建应用(run.py,init.py 等等)

<ol>
<li>使用 nano 编辑 run.py</li>
<li>使用 nano 编辑 config.py</li>
</ol></li>
<li>创建一个模块/组件

<ol>
<li>组织架构模型</li>
<li>定义模块数据类型</li>
<li>定义模块表单</li>
<li>定义应用控制器(views)</li>
<li>在 &quot;app/init.py&quot; 中建立应用</li>
<li>创建模板</li>
<li>实际操作中查看你的模型</li>
</ol></li>
</ol>

<h2 id="flask-最小的应用开发框架">Flask:最小的应用开发框架</h2>

<p>Flask 迷你的框架但是丝毫不会影响重要事情的处理方式。相反, Flask 允许开发者使用他们渴望的并且熟悉的工具。出于这个目的,它由此产生了自己的扩展索引和大量已经存在并解决大多数事情的的工具从登陆到日志方方面面。</p>

<p>它不是一个严格的“常规”框架，部分依赖于配置文件,这些配置文件使得其在开始使用和保持事项时变得更容易。</p>

<h2 id="我们在文章中的选择">我们在文章中的选择</h2>

<p>通过我们前面浏览的内容了解到,Flask 的方式就是让我们使用那些用起来最舒服的工具。在我们的文章中,我们将会使用最常见的扩展和库。这些选择包括:</p>

<ol>
<li>SQLAlchemy</li>
<li>WTForms</li>
</ol>

<h3 id="flask-sqlalchemy">Flask-SQLAlchemy</h3>

<p>在 Flask 中添加 SQLAlchemy 支持很快捷。这是一个很好的扩展。</p>
<pre class="chroma"><code><span class="line"><span class="cl">Author: Armin Ronacher
</span></span><span class="line"><span class="cl">PyPI Page: Flask-SQLAlchemy
</span></span><span class="line"><span class="cl">Documentation: Read docs @ packages.python.org
</span></span><span class="line"><span class="cl">On Github: <span class="o">[</span>mitsuhiko/flask-sqlalchemy<span class="o">]</span><span class="o">(</span>https://github.com/mitsuhiko/flask-sqlalchemy<span class="o">)</span>
</span></span></code></pre>
<h3 id="flask-wtf">Flask-WTF</h3>

<p>Flask-WTF 提供简单的 WTForms 集成。集成包括可选择的 用来提供更好安全保障的 CSRF。这也是一个很好的扩展。</p>
<pre class="chroma"><code><span class="line"><span class="cl">Author: Anthony Ford <span class="o">(</span>created by Dan Jacob<span class="o">)</span>
</span></span><span class="line"><span class="cl">PyPI Page: Flask-WTF
</span></span><span class="line"><span class="cl">Documentation: Read docs @ packages.python.org
</span></span><span class="line"><span class="cl">On Github: <span class="o">[</span>ajford/flask-wtf<span class="o">]</span><span class="o">(</span>https://github.com/mitsuhiko/flask-wtf<span class="o">)</span>
</span></span></code></pre>
<h2 id="准备-flask-系统">准备 Flask 系统</h2>

<h3 id="准备操作系统">准备操作系统</h3>

<p>使用如下命令安装必要的开发工具</p>
<pre class="chroma"><code><span class="line"><span class="cl">aptitude update
</span></span><span class="line"><span class="cl">aptitude -y upgrade
</span></span><span class="line"><span class="cl">aptitude install -y build-essential python-dev python2.7-dev
</span></span></code></pre>
<h3 id="安装python-pip以及virtualenv">安装python,pip以及virtualenv</h3>

<p>参考 <a href="https://zhuanlan.zhihu.com/p/26663186">Flask入门——从无到有构建一个网站 （二）环境搭建</a></p>

<h2 id="组织应用的目录">组织应用的目录</h2>

<p>我们将使用典型的大型应用名称作为我们的应用的文件夹。在文件夹里，我们将会有一个虚拟环境与此同时还有应用的包以及一些其他的文件夹包括 用来运行 测试(开发)环境的 &quot;run.py&quot; 和 Flask 的配置文件 &quot;config.py&quot;</p>

<p>下面给出的作为样例的目录结构，该目录结构是高度可扩展的,它构建的目的是充分利用 Flask 和其他库提供的工具。不要被它吓着了，我们将会一步一步构建它直至完成。</p>

<p>目标样例结构:</p>
<pre class="chroma"><code><span class="line"><span class="cl">~/LargeApp
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- run.py
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- config.py
</span></span><span class="line"><span class="cl">    <span class="p">|</span>__ /env             <span class="c1"># Virtual Environment</span>
</span></span><span class="line"><span class="cl">    <span class="p">|</span>__ /app             <span class="c1"># Our Application Module</span>
</span></span><span class="line"><span class="cl">         <span class="p">|</span>-- __init__.py
</span></span><span class="line"><span class="cl">         <span class="p">|</span>-- /module_one
</span></span><span class="line"><span class="cl">             <span class="p">|</span>-- __init__.py
</span></span><span class="line"><span class="cl">             <span class="p">|</span>-- controllers.py
</span></span><span class="line"><span class="cl">             <span class="p">|</span>-- models.py                
</span></span><span class="line"><span class="cl">         <span class="p">|</span>__ /templates
</span></span><span class="line"><span class="cl">             <span class="p">|</span>__ /module_one
</span></span><span class="line"><span class="cl">                 <span class="p">|</span>-- hello.html
</span></span><span class="line"><span class="cl">         <span class="p">|</span>__ /static
</span></span><span class="line"><span class="cl">         <span class="p">|</span>__ ..
</span></span><span class="line"><span class="cl">         <span class="p">|</span>__ .
</span></span><span class="line"><span class="cl">    <span class="p">|</span>__ ..
</span></span><span class="line"><span class="cl">    <span class="p">|</span>__ .
</span></span></code></pre>
<h3 id="创建应用文件夹">创建应用文件夹</h3>

<p>让我们开始创建我们需要的主要目录。
逐条去执行下述命令:</p>
<pre class="chroma"><code><span class="line"><span class="cl">mkdir ~/LargeApp
</span></span><span class="line"><span class="cl">mkdir ~/LargeApp/app
</span></span><span class="line"><span class="cl">mkdir ~/LargeApp/app/templates
</span></span><span class="line"><span class="cl">mkdir ~/LargeApp/app/static   
</span></span></code></pre>
<p>执行完成之后我们的当前目录</p>
<pre class="chroma"><code><span class="line"><span class="cl">~/LargeApp
</span></span><span class="line"><span class="cl">    <span class="p">|</span>__ /app             <span class="c1"># Our Application Module</span>
</span></span><span class="line"><span class="cl">         <span class="p">|</span>__ /templates
</span></span><span class="line"><span class="cl">         <span class="p">|</span>__ /static
</span></span></code></pre>
<h3 id="创建一个虚拟环境">创建一个虚拟环境</h3>

<p>使用一个虚拟环境能给你带来很多好处。对于你的每一个应用都强烈推荐使用一个新的虚拟环境。在你的应用中创建一个虚拟环境是一个很好的让你应用有序和干净的方法。</p>

<p>使用下列命令创建一个虚拟环境</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="nb">cd</span> ~/LargetApp
</span></span><span class="line"><span class="cl">virtualenv env
</span></span></code></pre>
<h3 id="创建应用文件">创建应用文件</h3>

<p>在这步，我们将会在使用 modules 和 blueprints 之前创建我们基础应用文件。</p>

<p>运行下列文件创建基本应用文件:</p>
<pre class="chroma"><code><span class="line"><span class="cl">touch ~/LargeApp/run.py
</span></span><span class="line"><span class="cl">touch ~/LargeApp/config.py
</span></span><span class="line"><span class="cl">touch ~/LargeApp/app/__init__.py
</span></span></code></pre>
<p>我们当前的结构:</p>
<pre class="chroma"><code><span class="line"><span class="cl">~/LargeApp
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- run.py
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- config.py
</span></span><span class="line"><span class="cl">    <span class="p">|</span>__ /env             <span class="c1"># Virtual Environment</span>
</span></span><span class="line"><span class="cl">    <span class="p">|</span>__ /app             <span class="c1"># Our Application Module</span>
</span></span><span class="line"><span class="cl">         <span class="p">|</span>-- __init__.py
</span></span><span class="line"><span class="cl">         <span class="p">|</span>__ /templates
</span></span><span class="line"><span class="cl">         <span class="p">|</span>__ /static
</span></span></code></pre>
<h3 id="安装-flask-和相关依赖库">安装 Flask 和相关依赖库</h3>

<p>目录什么都创建好之后，我们开始使用 pip 下载安装我们的Flask</p>

<p>使用下述命令将 Flask 安装到虚拟环境当中:</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="nb">cd</span> ~/LargeApp
</span></span><span class="line"><span class="cl">env/bin/pip install flask
</span></span><span class="line"><span class="cl">env/bin/pip install flask-sqlalchemy
</span></span><span class="line"><span class="cl">env/bin/pip install flask-wtf
</span></span></code></pre>
<h2 id="使用-modules-和-blueprints-组件">使用 Modules 和 Blueprints（组件）</h2>

<h3 id="基础模块">基础模块</h3>

<p>在走到这一步的时候，我们已经将我们的应用结构创建好了并且也将所有的依赖下载完成了。</p>

<p>我们的目标是模块化可逻辑分组的所有相关模块。</p>

<p>举个简单的例子比如认证系统。将所有视图，控制器，模型和帮助器置于一个位置，以允许可重用性的方式进行设置，这使得这种结构化成为维护应用程序同时提高生产力的好方法。</p>

<p>目标案例模块(组件)结构(在/app里面)：</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="c1"># Our module example here is called *mod_auth*</span>
</span></span><span class="line"><span class="cl"><span class="c1"># You can name them as you like as long as conventions are followed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/mod_auth
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- __init__.py
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- controllers.py
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- models.py
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- ..
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- .
</span></span></code></pre>
<h3 id="模块模板">模块模板</h3>

<p>为了使得达到最大的模块化，我们将遵循上述规定创建 “templates” 文件夹,同时并保护一个与模块相同或相似的相关名称的新文件夹，以包含其模板文件。</p>

<p>目标样例模板目录结构(在 LargeApp 中):</p>
<pre class="chroma"><code><span class="line"><span class="cl">/templates
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- 404.html
</span></span><span class="line"><span class="cl">    <span class="p">|</span>__ /auth
</span></span><span class="line"><span class="cl">         <span class="p">|</span>-- signin.html
</span></span><span class="line"><span class="cl">         <span class="p">|</span>-- signup.html
</span></span><span class="line"><span class="cl">         <span class="p">|</span>-- forgot.html
</span></span><span class="line"><span class="cl">         <span class="p">|</span>-- ..
</span></span><span class="line"><span class="cl">         <span class="p">|</span>-- .
</span></span></code></pre>
<h2 id="创建应用">创建应用</h2>

<p>在本节中，我们将继续前面的步骤，并从我们的应用程序的实际编码开始，然后再转到创建第一个模块化组件（使用蓝图）：mod_auth，其用来处理所有与身份验证相关的过程。</p>

<h3 id="使用-nano-编辑-run-py">使用 nano 编辑 &quot;run.py&quot;</h3>
<pre class="chroma"><code><span class="line"><span class="cl">nano ~/LargeApp/run.py
</span></span></code></pre>
<p>输入如下内容:</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="c1"># Run a test server.</span>
</span></span><span class="line"><span class="cl">from app import app
</span></span><span class="line"><span class="cl">app.run<span class="o">(</span><span class="nv">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span>, <span class="nv">port</span><span class="o">=</span>8080, <span class="nv">debug</span><span class="o">=</span>True<span class="o">)</span>
</span></span></code></pre>
<p>保存退出。</p>

<h3 id="使用-nano-编辑-config-py">使用 nano 编辑 &quot;config,py&quot;</h3>
<pre class="chroma"><code><span class="line"><span class="cl">nano ~/LargeApp/config.py
</span></span></code></pre>
<p>输入如下内容:</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="c1"># Statement for enabling the development environment</span>
</span></span><span class="line"><span class="cl"><span class="nv">DEBUG</span> <span class="o">=</span> True
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the application directory</span>
</span></span><span class="line"><span class="cl">import os
</span></span><span class="line"><span class="cl"><span class="nv">BASE_DIR</span> <span class="o">=</span> os.path.abspath<span class="o">(</span>os.path.dirname<span class="o">(</span>__file__<span class="o">)</span><span class="o">)</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the database - we are working with</span>
</span></span><span class="line"><span class="cl"><span class="c1"># SQLite for this example</span>
</span></span><span class="line"><span class="cl"><span class="nv">SQLALCHEMY_DATABASE_URI</span> <span class="o">=</span> <span class="s1">&#39;sqlite:///&#39;</span> + os.path.join<span class="o">(</span>BASE_DIR, <span class="s1">&#39;app.db&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">DATABASE_CONNECT_OPTIONS</span> <span class="o">=</span> <span class="o">{</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Application threads. A common general assumption is</span>
</span></span><span class="line"><span class="cl"><span class="c1"># using 2 per available processor cores - to handle</span>
</span></span><span class="line"><span class="cl"><span class="c1"># incoming requests using one and performing background</span>
</span></span><span class="line"><span class="cl"><span class="c1"># operations using the other.</span>
</span></span><span class="line"><span class="cl"><span class="nv">THREADS_PER_PAGE</span> <span class="o">=</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Enable protection agains *Cross-site Request Forgery (CSRF)*</span>
</span></span><span class="line"><span class="cl"><span class="nv">CSRF_ENABLED</span>     <span class="o">=</span> True
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Use a secure, unique and absolutely secret key for</span>
</span></span><span class="line"><span class="cl"><span class="c1"># signing the data. </span>
</span></span><span class="line"><span class="cl"><span class="nv">CSRF_SESSION_KEY</span> <span class="o">=</span> <span class="s2">&#34;secret&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Secret key for signing cookies</span>
</span></span><span class="line"><span class="cl"><span class="nv">SECRET_KEY</span> <span class="o">=</span> <span class="s2">&#34;secret&#34;</span>
</span></span></code></pre>
<p>保存退出。</p>

<h2 id="创建模块-组件">创建模块/组件</h2>

<p>本节是定义本文核心的第一个主要步骤。 在这里，我们将看到如何使用Flask的蓝图来创建一个模块（即组件）。</p>

<h3 id="第一步-结构化模块">第一步 结构化模块</h3>

<p>正如我们已经开始做的，让我们创建我们的第一个模块（mod_auth）目录和文件来开始工作。</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="c1"># Create the module directory inside the *app* module</span>
</span></span><span class="line"><span class="cl">mkdir ~/LargeApp/app/mod_auth
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create where module&#39;s templates will reside</span>
</span></span><span class="line"><span class="cl">mkdir ~/LargeApp/app/templates/auth
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create __init__.py to set the directory as a Python module</span>
</span></span><span class="line"><span class="cl">touch ~/LargeApp/app/mod_auth/__init__.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create module&#39;s controllers and models etc.</span>
</span></span><span class="line"><span class="cl">touch ~/LargeApp/app/mod_auth/controllers.py
</span></span><span class="line"><span class="cl">touch ~/LargeApp/app/mod_auth/models.py
</span></span><span class="line"><span class="cl">touch ~/LargeApp/app/mod_auth/forms.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create module&#39;s templates</span>
</span></span><span class="line"><span class="cl">touch ~/LargeApp/app/templates/auth/signin.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a HTTP 404 Error page</span>
</span></span><span class="line"><span class="cl">touch ~/LargeApp/app/templates/404.html
</span></span></code></pre>
<p>在上述操作过程之后,我们的目录结构类似这样:</p>
<pre class="chroma"><code><span class="line"><span class="cl">~/LargeApp
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- run.py
</span></span><span class="line"><span class="cl">    <span class="p">|</span>-- config.py
</span></span><span class="line"><span class="cl">    <span class="p">|</span>__ /env             <span class="c1"># Virtual Environment</span>
</span></span><span class="line"><span class="cl">    <span class="p">|</span>__ /app             <span class="c1"># Our Application Module</span>
</span></span><span class="line"><span class="cl">         <span class="p">|</span>-- __init__.py
</span></span><span class="line"><span class="cl">         <span class="p">|</span>-- /mod_auth   <span class="c1"># Our first module, mod_auth</span>
</span></span><span class="line"><span class="cl">             <span class="p">|</span>-- __init__.py
</span></span><span class="line"><span class="cl">             <span class="p">|</span>-- controllers.py
</span></span><span class="line"><span class="cl">             <span class="p">|</span>-- models.py
</span></span><span class="line"><span class="cl">             <span class="p">|</span>-- forms.py
</span></span><span class="line"><span class="cl">         <span class="p">|</span>__ /templates
</span></span><span class="line"><span class="cl">             <span class="p">|</span>-- 404.html
</span></span><span class="line"><span class="cl">             <span class="p">|</span>__ /auth
</span></span><span class="line"><span class="cl">                 <span class="p">|</span>-- signin.html
</span></span><span class="line"><span class="cl">         <span class="p">|</span>__ /static
</span></span></code></pre>
<h3 id="第二步-定义模块数据模型">第二步 定义模块数据模型</h3>
<pre class="chroma"><code><span class="line"><span class="cl">nano ~/LargeApp/app/mod_auth/models.py
</span></span></code></pre>
<p>输入下述内容</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="c1"># Import the database object (db) from the main application module</span>
</span></span><span class="line"><span class="cl"><span class="c1"># We will define this inside /app/__init__.py in the next sections.</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define a base model for other database tables to inherit</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">__abstract__</span>  <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">id</span>            <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">date_created</span>  <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span>  <span class="n">default</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">current_timestamp</span><span class="p">(</span><span class="p">)</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">date_modified</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span>  <span class="n">default</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">current_timestamp</span><span class="p">(</span><span class="p">)</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                           <span class="n">onupdate</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">current_timestamp</span><span class="p">(</span><span class="p">)</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define a User model</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">auth_user</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># User Name</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span>    <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="p">,</span>  <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Identification Data: email &amp; password</span>
</span></span><span class="line"><span class="cl">    <span class="n">email</span>    <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="p">,</span>  <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                            <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span><span class="p">,</span>  <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Authorisation Data: role &amp; status</span>
</span></span><span class="line"><span class="cl">    <span class="n">role</span>     <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">SmallInteger</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">status</span>   <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">SmallInteger</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># New instance instantiation procedure</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>     <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">email</span>    <span class="o">=</span> <span class="n">email</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">&lt;User </span><span class="si">%r</span><span class="s1">&gt;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>      
</span></span></code></pre>
<p>保存并退出</p>

<h3 id="第三步-定义模块表单">第三步 定义模块表单</h3>
<pre class="chroma"><code><span class="line"><span class="cl">nano ~/LargeApp/app/mod_auth/forms.py
</span></span></code></pre>
<p>输入下述内容:</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="c1"># Import Form and RecaptchaField (optional)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span><span class="nn">.</span><span class="nn">ext</span><span class="nn">.</span><span class="nn">wtf</span> <span class="kn">import</span> <span class="n">Form</span> <span class="c1"># , RecaptchaField</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Import Form elements such as TextField and BooleanField (optional)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">TextField</span><span class="p">,</span> <span class="n">PasswordField</span> <span class="c1"># BooleanField</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Import Form validators</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">wtforms</span><span class="nn">.</span><span class="nn">validators</span> <span class="kn">import</span> <span class="n">Required</span><span class="p">,</span> <span class="n">Email</span><span class="p">,</span> <span class="n">EqualTo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the login form (WTForms)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoginForm</span><span class="p">(</span><span class="n">Form</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">email</span>    <span class="o">=</span> <span class="n">TextField</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">Email Address</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">Email</span><span class="p">(</span><span class="p">)</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">Required</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">Forgot your email address?</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">PasswordField</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">Password</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="n">Required</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">Must provide a password. ;-)</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">]</span><span class="p">)</span>
</span></span></code></pre>
<p>保存并退出</p>

<h3 id="第四步-定义应用控制器-视图">第四步 定义应用控制器(视图)</h3>
<pre class="chroma"><code><span class="line"><span class="cl">nano ~/LargeApp/app/mod_auth/controllers.py
</span></span></code></pre>
<p>输入下述内容</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="c1"># Import flask dependencies</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> \
</span></span><span class="line"><span class="cl">                  <span class="n">flash</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Import password / encryption helper tools</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">werkzeug</span> <span class="kn">import</span> <span class="n">check_password_hash</span><span class="p">,</span> <span class="n">generate_password_hash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Import the database object from the main app module</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Import module forms</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">app</span><span class="nn">.</span><span class="nn">mod_auth</span><span class="nn">.</span><span class="nn">forms</span> <span class="kn">import</span> <span class="n">LoginForm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Import module models (i.e. User)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">app</span><span class="nn">.</span><span class="nn">mod_auth</span><span class="nn">.</span><span class="nn">models</span> <span class="kn">import</span> <span class="n">User</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the blueprint: &#39;auth&#39;, set its url prefix: app.url/auth</span>
</span></span><span class="line"><span class="cl"><span class="n">mod_auth</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">auth</span><span class="s1">&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">/auth</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set the route and accepted methods</span>
</span></span><span class="line"><span class="cl"><span class="nd">@mod_auth.route</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">/signin/</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">GET</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">POST</span><span class="s1">&#39;</span><span class="p">]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">signin</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># If sign in form is submitted</span>
</span></span><span class="line"><span class="cl">    <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Verify the sign in form</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">password</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">session</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">user_id</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">flash</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">Welcome </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">auth.home</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">flash</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">Wrong email or password</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">error-message</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">auth/signin.html</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</span></span></code></pre>
<p>保存并退出</p>

<h3 id="第五步-在应用中创建-app-init-py">第五步 在应用中创建 &quot;app/init.py&quot;</h3>
<pre class="chroma"><code><span class="line"><span class="cl">nano ~/LargeApp/app/__init__.py
</span></span></code></pre>
<p>输入以下内容:</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="c1"># Import flask and template operators</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Import SQLAlchemy</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span><span class="nn">.</span><span class="nn">ext</span><span class="nn">.</span><span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">SQLAlchemy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the WSGI application object</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Configurations</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">config</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the database object which is imported</span>
</span></span><span class="line"><span class="cl"><span class="c1"># by modules and controllers</span>
</span></span><span class="line"><span class="cl"><span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample HTTP error handling</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">not_found</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">404.html</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span> <span class="mi">404</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Import a module / component using its blueprint handler variable (mod_auth)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">app</span><span class="nn">.</span><span class="nn">mod_auth</span><span class="nn">.</span><span class="nn">controllers</span> <span class="kn">import</span> <span class="n">mod_auth</span> <span class="k">as</span> <span class="n">auth_module</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Register blueprint(s)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">auth_module</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># app.register_blueprint(xyz_module)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ..</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Build the database:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># This will create the database file using SQLAlchemy</span>
</span></span><span class="line"><span class="cl"><span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="p">)</span>
</span></span></code></pre>
<p>保存并退出</p>

<h3 id="第六步-创建模板">第六步 创建模板</h3>
<pre class="chroma"><code><span class="line"><span class="cl">nano ~/LargeApp/app/templates/auth/signin.html
</span></span></code></pre>
<p>输入以下内容:</p>
<pre class="chroma"><code><span class="line"><span class="cl">{% macro render_field(field, placeholder=None) %}
</span></span><span class="line"><span class="cl">{% if field.errors %}
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">{% elif field.flags.error %}
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">{% else %}
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">{% endif %}
</span></span><span class="line"><span class="cl">    {% set css_class = &#39;form-control &#39; + kwargs.pop(&#39;class&#39;, &#39;&#39;) %}
</span></span><span class="line"><span class="cl">    {{ field(class=css_class, placeholder=placeholder, **kwargs) }}
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">{% endmacro %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">legend</span><span class="p"></span><span class="p">&gt;</span>Sign in<span class="p">&lt;</span><span class="p">/</span><span class="nt">legend</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {% with errors = get_flashed_messages(category_filter=[&#34;error&#34;]) %}
</span></span><span class="line"><span class="cl">    {% if errors %}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {% for error in errors %}
</span></span><span class="line"><span class="cl">    {{ error }}<span class="p">&lt;</span><span class="nt">br</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {% endif %}
</span></span><span class="line"><span class="cl">    {% endwith %}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    {% if form.errors %}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {% for field, error in form.errors.items() %}
</span></span><span class="line"><span class="cl">    {% for e in error %}
</span></span><span class="line"><span class="cl">    {{ e }}<span class="p">&lt;</span><span class="nt">br</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">    {% endfor %}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {% endif %}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;POST&#34;</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;.&#34;</span> <span class="na">accept-charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;form&#34;</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      {{ form.csrf_token }}
</span></span><span class="line"><span class="cl">      {{ render_field(form.email, placeholder=&#34;Your Email Address&#34;,
</span></span><span class="line"><span class="cl">                                  autofocus=&#34;&#34;) }}
</span></span><span class="line"><span class="cl">      {{ render_field(form.password, placeholder=&#34;Password&#34;) }}
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">label</span><span class="p"></span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;checkbox&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;remember&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;1&#34;</span><span class="p"></span><span class="p">&gt;</span> Remember Me
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="p">/</span><span class="nt">label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p"></span><span class="p">&gt;</span>Forgot your password?<span class="p">&lt;</span><span class="p">/</span><span class="nt">a</span><span class="p">&gt;</span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;clearfix&#34;</span><span class="p"></span><span class="p">&gt;</span><span class="p">&lt;</span><span class="p">/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p"></span><span class="p">&gt;</span>Sign in<span class="p">&lt;</span><span class="p">/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="p">/</span><span class="nt">form</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span></code></pre>
<p>保存并退出</p>

<h3 id="第七步-从网页浏览你定义的模块">第七步 从网页浏览你定义的模块</h3>

<p>模块创建成功了，接下来就是查看我们定义的模板了</p>

<p>运行 <code>run.py</code> 文件启动开发环境服务器</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="nb">cd</span> ~/LargeApp
</span></span><span class="line"><span class="cl">env/bin/python run.py
</span></span></code></pre>
<p>上述命令将会初始化一个开发环境服务器，端口为 8080.
通过 URL 去访问我们的模块</p>
<pre class="chroma"><code><span class="line"><span class="cl">http://<span class="o">[</span>your droplet<span class="err">&#39;</span>s IP<span class="o">]</span>/auth/signin
</span></span></code></pre>
<p>虽然您无法登录，但您可以通过输入一些示例数据或通过测试其验证器来查看它。</p>

            </div>
            
            <div class="tag-list">
                
            </div>
            
            <div class="giscus">
                <script src="https://giscus.app/client.js"
                    data-repo="leetaogoooo/discussion-blog"
                    data-repo-id="R_kgDOIOm9Yg"
                    data-mapping="number"
                    data-term="58"
                    data-reactions-enabled="1"
                    data-emit-metadata="0"
                    data-input-position="top"
                    data-theme="light"
                    data-lang="en"
                    crossorigin="anonymous"
                    async>
                </script>
            </div>
            
        </article>
    </main>
    
    <footer>
        <p>&copy; Leetao. All rights reserved.</p>
    </footer>
    
    <script src="/js/theme-toggle.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            const giscusScript = document.querySelector('script[src^="https://giscus.app/client.js"]');
            const setGiscusTheme = (theme) => {
                if (giscusScript) {
                    const message = { setConfig: { theme: theme } };
                    const iframe = document.querySelector('.giscus-frame');
                    if (iframe) {
                        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
                    }
                }
            };
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            setGiscusTheme(currentTheme);
            new MutationObserver((mutations) => {
                mutations.forEach(mutation => {
                    if (mutation.attributeName === 'data-theme') {
                        setGiscusTheme(mutation.target.getAttribute('data-theme'));
                    }
                });
            }).observe(document.documentElement, { attributes: true });


            
            function initCopyButtons() {
                document.querySelectorAll('pre.chroma').forEach((pre) => {
                    
                    const existingButton = pre.querySelector('.copy-button');
                    if (existingButton) {
                        existingButton.remove();
                    }
                    
                    const button = document.createElement('button');
                    button.className = 'copy-button';
                    button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                    
                    pre.style.position = 'relative';
                    pre.appendChild(button);
                    
                    button.addEventListener('click', () => {
                        const code = pre.querySelector('code');
                        if (code) {
                            navigator.clipboard.writeText(code.innerText).then(() => {
                                button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"></path></svg>';
                                setTimeout(() => {
                                    button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                                }, 2000);
                            });
                        }
                    });
                });
                const button = document.createElement('button');
                button.className = 'copy-button';
                button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                
                pre.style.position = 'relative';
                pre.appendChild(button);
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code');
                    if (code) {
                        navigator.clipboard.writeText(code.innerText).then(() => {
                            button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"></path></svg>';
                            setTimeout(() => {
                                button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                            }, 2000);
                        });
                    }
                });
            }
            
            
            initCopyButtons();
            
            
            document.addEventListener('themeChanged', () => {
                initCopyButtons();
            });
        });
    </script>
</body>
</html>