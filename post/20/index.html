<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using Keyboard Shortcuts in Flutter Desktop - Leetao</title>
    <meta name="description" content="# Intro

Using keyboard shortcuts in desktop is a common case, it can boost our productivity when used correctly. In flutter, there&#39;re two ways for us to buil...">
    
    <link rel="icon" href="/favicon.svg" type="image/x-icon">
    
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
</head>
<body>
    <header>
        <h1><a href="/">Leetao</a></h1>
        
        <p class="site-description">写有趣的代码，做有趣的事</p>
        
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/tags/">Tags</a></li>
                <li><a href="/about/">About</a></li>
                <li><button class="theme-toggle" id="theme-toggle">
                    <svg class="theme-icon" viewBox="0 0 24 24" width="16" height="16">
                        <path d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/>
                    </svg>
                    Theme
                </button></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <article class="post">
            <h1>Using Keyboard Shortcuts in Flutter Desktop</h1>
            <p class="meta">
                By LeetaoGoooo on July 15, 2023
            </p>
            
            <div class="content">
                <h1>Intro</h1>

<p>Using keyboard shortcuts in desktop is a common case, it can boost our productivity when used correctly. In flutter, there&rsquo;re two ways for us to build keyboard shortcuts in desktop app. One is <a href="https://api.flutter.dev/flutter/widgets/RawKeyboardListener-class.html">RawKeyboardListener</a>  and the another is <a href="https://api.flutter-io.cn/flutter/widgets/Shortcuts-class.html">Shortcuts</a>, but they have significant differences.</p>

<h1>RawKeyboardListener</h1>

<blockquote>
<p>A <a href="https://api.flutter.dev/flutter/widgets/RawKeyboardListener-class.html">RawKeyboardListener</a> is useful for listening to raw key events and hardware buttons that are represented as keys. Typically used by games and other apps that use keyboards for purposes other than text entry.<br />
It allows you to listen to &ldquo;key-up&rdquo; and &ldquo;key-down&rdquo; events on the keyboard</p>
</blockquote>

<pre><code class="language-dart">  @override
   Widget build(BuildContext context) {
     return KeyboardListener(
         autofocus: true,
         onKeyEvent: (event) {
           if (event.runtimeType == RawKeyDownEvent) {
           } else {
             
           }
         },
         focusNode: FocusNode(),
         child: child,
      );
   }
</code></pre>

<p>Undoubtedly, we can use this widget to implement keyboard shortcuts. But in reality, it&rsquo;s a bit complex, and most of the time, we don&rsquo;t want to filter keydown events.</p>

<p>More importantly, if you want to use shortcuts with <a href="https://github.com/google/flutter-desktop-embedding/tree/master/plugins/menubar">menu bar plugin</a>, you will need to use <code>LogicalKeySet</code>, while <code>RawKeyboardListener</code> is not based on this.</p>

<p>Moreover, RawKeyboardListener may not work as expected sometimes, for example, when you have to deal with hotkeys with modifiers Ctrl or Alt. Code may like this:</p>

<pre><code class="language-dart">  RawKeyboardListener(
          autofocus: true,
          onKey: (event) {
            if (event.runtimeType == RawKeyDownEvent) {
               print(event.logicalKey);
              if (event.isKeyPressed(LogicalKeyboardKey.control) &amp;&amp;
                  event.isKeyPressed(LogicalKeyboardKey.keyC)) {
                _incrementCounter();
              }
            }
          },
          focusNode: FocusNode(),
          child: child
    )
</code></pre>

<p>But actually, <code>event.logicalKey</code> will print <code>Control Left</code> or  <code>Control Right</code> and <code>event.isKeyPressed(LogicalKeyboardKey.control)</code> will <strong>never</strong> return <code>true</code>. For that purpose, you need to recorrect code like:</p>

<pre><code class="language-dart">  ...  
  if ((event.isKeyPressed(LogicalKeyboardKey.controlLeft) ||  event.isKeyPressed(LogicalKeyboardKey.controlLeft) &amp;&amp;
                  event.isKeyPressed(LogicalKeyboardKey.keyC)) {
                _incrementCounter();
              }
</code></pre>

<p>Therefore, if you want to use keyboard shortcuts in desktop applications built using Flutter, you should consider the <a href="https://api.flutter.dev/flutter/widgets/Shortcuts-class.html">Shortcuts</a> widget. It&rsquo;s a simpler and more convenient way to create keyboard shortcuts in Flutter.</p>

<h1>Shortcuts</h1>

<blockquote>
<p>A widget that creates key bindings to specific actions for its descendants. See the article on <a href="https://docs.flutter.cn/development/ui/advanced/actions_and_shortcuts">Using Actions and Shortcuts</a> for a detailed explanation.<br />
It takes in a map of <strong>shortcuts</strong> (LogicalKeySet: Intent), and <strong>actions</strong> (Intent: Action).</p>
</blockquote>

<h2>Intents and Actions</h2>

<p>An intent always represents particular configuration of an <a href="https://api.flutter-io.cn/flutter/widgets/Action-class.html">Action</a>. Take the example of a desktop with a keyboard shortcuts that Increase/decrease. An intent for this would like this:</p>

<pre><code class="language-dart">  class IncrementIntent extends Intent {
    const IncrementIntent();
  }
  
  class DecrementIntent extends Intent {
    const DecrementIntent();
  }
  
</code></pre>

<p>And what action does, it will do something once an Intent is received. In our copy example, an action for the intent would look like this:</p>

<pre><code class="language-dart">  Actions(
          actions: &lt;Type, Action&lt;Intent&gt;&gt;{
            IncrementIntent: CallbackAction&lt;IncrementIntent&gt;(
              onInvoke: (IncrementIntent intent) =&gt; setState(() {
                count = count + 1;
              }),
            ),
            DecrementIntent: CallbackAction&lt;DecrementIntent&gt;(
              onInvoke: (DecrementIntent intent) =&gt; setState(() {
                count = count - 1;
              }),
            ),
          }
</code></pre>

<p>You can define different types of actions and intents for different scenarios.</p>

<h2>Example Using Shortcuts</h2>

<p>source code comes from <a href="https://api.flutter-io.cn/flutter/widgets/Shortcuts-class.html">Shortcuts  Class</a></p>

<pre><code class="language-dart">  import 'package:flutter/material.dart';
  import 'package:flutter/services.dart';
  
  /// Flutter code sample for [Shortcuts].
  
  void main() =&gt; runApp(const ShortcutsExampleApp());
  
  class ShortcutsExampleApp extends StatelessWidget {
    const ShortcutsExampleApp({super.key});
  
    @override
    Widget build(BuildContext context) {
      return MaterialApp(
        home: Scaffold(
          appBar: AppBar(title: const Text('Shortcuts Sample')),
          body: const Center(
            child: ShortcutsExample(),
          ),
        ),
      );
    }
  }
  
  class IncrementIntent extends Intent {
    const IncrementIntent();
  }
  
  class DecrementIntent extends Intent {
    const DecrementIntent();
  }
  
  class ShortcutsExample extends StatefulWidget {
    const ShortcutsExample({super.key});
  
    @override
    State&lt;ShortcutsExample&gt; createState() =&gt; _ShortcutsExampleState();
  }
  
  class _ShortcutsExampleState extends State&lt;ShortcutsExample&gt; {
    int count = 0;
  
    @override
    Widget build(BuildContext context) {
      return Shortcuts(
        shortcuts: const &lt;ShortcutActivator, Intent&gt;{
          SingleActivator(LogicalKeyboardKey.arrowUp): IncrementIntent(),
          SingleActivator(LogicalKeyboardKey.arrowDown): DecrementIntent(),
        },
        child: Actions(
          actions: &lt;Type, Action&lt;Intent&gt;&gt;{
            IncrementIntent: CallbackAction&lt;IncrementIntent&gt;(
              onInvoke: (IncrementIntent intent) =&gt; setState(() {
                count = count + 1;
              }),
            ),
            DecrementIntent: CallbackAction&lt;DecrementIntent&gt;(
              onInvoke: (DecrementIntent intent) =&gt; setState(() {
                count = count - 1;
              }),
            ),
          },
          child: Focus(
            autofocus: true,
            child: Column(
              children: &lt;Widget&gt;[
                const Text('Add to the counter by pressing the up arrow key'),
                const Text(
                    'Subtract from the counter by pressing the down arrow key'),
                Text('count: $count'),
              ],
            ),
          ),
        ),
      );
    }
  }
  
</code></pre>

<h1>RawKeyboardListener vs Shortcuts</h1>

<p>In summary, RawKeyboardListener is more powerful than Shortcuts, it can listen all keyboard event, include &ldquo;key-up&rdquo; and &ldquo;key-down&rdquo; events, among others.  However, this also means RawKeyboardListener is more complex than Shortcuts. On the other hand, Shortcuts is easier to use and make code  clearer. After all, you define all the action and intent at first.</p>

<h1>Reference</h1>

<ul>
<li><a href="https://wilsonwilson.dev/articles/keyboard-shortcuts-in-flutter">Using Keyboard Shortcuts in Flutter Desktop</a></li>
<li><a href="https://medium.com/@syazwan03nasir/flutter-how-to-use-rawkeyboardlistener-widget-6fb177918f29">Flutter: How To Use RawKeyboardListener Widget</a></li>
<li><a href="https://api.flutter.dev/flutter/widgets/RawKeyboardListener-class.html">RawKeyboardListener</a></li>
<li><a href="https://api.flutter-io.cn/flutter/widgets/Action-class.html">Action</a></li>
<li><a href="https://api.flutter-io.cn/flutter/widgets/Shortcuts-class.html">Shortcuts</a></li>
</ul>

            </div>
            
            <div class="tags">
                
                <span class="tag">dart</span>
                
                <span class="tag">flutter</span>
                
            </div>
            
            <div class="giscus">
                <script src="https://giscus.app/client.js"
                    data-repo="leetaogoooo/discussion-blog"
                    data-repo-id="R_kgDOIOm9Yg"
                    data-mapping="number"
                    data-term="20"
                    data-reactions-enabled="1"
                    data-emit-metadata="0"
                    data-input-position="top"
                    data-theme="preferred_color_scheme"
                    data-lang="zh-CN"
                    data-loading="lazy"
                    crossorigin="anonymous"
                    async>
                </script>
            </div>
            
            <div class="back-link">
                <a href="/">&larr; Back to posts</a>
            </div>
        </article>
    </main>
    
    <footer>
        <p>&copy; Leetao. All rights reserved.</p>
    </footer>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="/js/theme-toggle.js"></script>
    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            
            const pres = document.querySelectorAll('pre');
            pres.forEach(pre => {
                
                const button = document.createElement('button');
                button.className = 'copy-button';
                button.textContent = 'Copy';
                
                
                pre.appendChild(button);
                
                
                button.addEventListener('click', () => {
                    
                    const code = pre.querySelector('code');
                    const text = code ? code.textContent : pre.textContent;
                    
                    
                    navigator.clipboard.writeText(text).then(() => {
                        
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        
                        
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 3000);
                    }).catch(err => {
                        console.error('Failed to copy: ', err);
                    });
                });
            });
        });
    </script>
</body>
</html>