<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>解决 openpyxl 垂直分页符和水平分页符同时添加的问题 - Leetao</title>
    <meta name="description" content="





# 前言

十天前知乎上有人提问 [python:openpyxl模块怎么给表格添加分页符？实现分页打印功能？](https://www.zhihu.com/questio...">
    
    <link rel="icon" href="/favicon.svg" type="image/x-icon">
    
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/chroma.css">
    <link rel="alternate" type="application/rss+xml" href="/rss.xml" title="RSS Feed">
</head>
<body class="container">
    <header class="site-header">
        <div class="site-header__left">
            <a href="/" class="site-title">Leetao</a>
            
            <p class="site-description">写有趣的代码，做有趣的事</p>
            
        </div>
        <div class="site-header__right">
            <nav class="site-nav">
                <a href="/">Home</a>
                <a href="/tags/">Tags</a>
                <a href="/about/">About</a>
                <button class="theme-toggle" id="theme-toggle">
                    <svg class="theme-icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </nav>
        </div>
    </header>
    
    <main>
        <article class="post">
            <header class="post-header">
                <h1 class="post-title">解决 openpyxl 垂直分页符和水平分页符同时添加的问题</h1>
                <p class="post-meta">
                    By LeetaoGoooo on July 16, 2023
                </p>
            </header>
            
            <div class="post-content">
                <h1 id="前言">前言</h1>

<p>十天前知乎上有人提问 <a href="https://www.zhihu.com/question/305289263/answer/549313223">python:openpyxl模块怎么给表格添加分页符？实现分页打印功能？</a>,看到问题之后,我很快的给他了一个如何添加垂直分页符或水平分页符的示例,你以为问题就结束了?我是这么以为的,但是事实证明,我太天真了,就在我给出示例的几分钟后,他在我的回答下评论了,说是<strong>同时添加垂直分页符和水平分页符失败了</strong>.
我当时的第一反应:
<img src="http://ww1.sinaimg.cn/large/006wYWbGly1fyegeyuiomj30j60j63z8.jpg" alt="" />
心里想着,肯定是他的写法有问题,毫不犹豫的回复到,&quot; 没有试过同时添加两种分页符的操作,默认是水平分页符,如果你先添加了垂直分页符的话,应该后面需要重新声明:openpyxl.worksheet.pagebreak.PageBreak.tagname = &quot;rowBreaks&quot;,听着自己飞快击打键盘的声音,自己不经有点飘飘然.就在沉浸在自己的YY当中,又过去了几分钟,他用正确的代码错误的结果狠狠的摔在了我的脸上:</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="n">col_break</span> <span class="o">=</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">worksheet</span><span class="o">.</span><span class="n">pagebreak</span><span class="o">.</span><span class="n">Break</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1">#创建分页符，参数5：在第5/6中间分页</span>
</span></span><span class="line"><span class="cl"><span class="n">sheet1</span><span class="o">.</span><span class="n">page_breaks</span><span class="o">.</span><span class="n">tagname</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">rowBreaks</span><span class="s1">&#39;</span> <span class="c1">#分页符属性设置为行分页符</span>
</span></span><span class="line"><span class="cl"><span class="n">sheet1</span><span class="o">.</span><span class="n">page_breaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_break</span><span class="p">)</span> <span class="c1">#把分页符对象添加到sheet对象里</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">row_break</span> <span class="o">=</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">worksheet</span><span class="o">.</span><span class="n">pagebreak</span><span class="o">.</span><span class="n">Break</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">#创建分页符</span>
</span></span><span class="line"><span class="cl"><span class="n">sheet1</span><span class="o">.</span><span class="n">page_breaks</span><span class="o">.</span><span class="n">tagname</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">colBreaks</span><span class="s1">&#39;</span> <span class="c1">#分页符属性设置为列分页符</span>
</span></span><span class="line"><span class="cl"><span class="n">sheet1</span><span class="o">.</span><span class="n">page_breaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_break</span><span class="p">)</span> <span class="c1">#把分页符对象添加到sheet对象里</span>
</span></span></code></pre>
<p>&quot;结果是在第3和5列添加了两个垂直分页符，是哪里有问题？大师&quot;,他问道.  我看了一眼代码好像没有错,我的心有点慌了,双手开始微微颤抖起来,一遍又一遍地仔细地巡视着代码,视图找出错误反驳他,但是并没有,抱着最后的希望,我把他的代码复制到自己的文件中,然后敲下回车符, excel 文件静静的生成在目录下,这可能是我最后的希望了.拿鼠标的手不自觉的颤抖起来,那么小的屏幕,那么大的文件,鼠标怎么半天都没办法移动上去,我深吸一口气,控制住自己手,终于把鼠标一上去了,双击excel,闭上眼睛,再睁开,我知道,我错了.但是就这么放弃了吗?绝不!我要把这个问题打到!</p>

<h1 id="亮剑">亮剑</h1>

<blockquote>
<p>&quot;是时候展示真正的技术了&quot;</p>
</blockquote>

<p>俗话说&quot;解铃还须系铃人&quot;,我们还得自己看一下问题代码:</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="c1"># example.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">Workbook</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">openpyxl</span><span class="nn">.</span><span class="nn">compat</span> <span class="kn">import</span> <span class="nb">range</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">openpyxl</span><span class="nn">.</span><span class="nn">utils</span> <span class="kn">import</span> <span class="n">get_column_letter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">openpyxl</span><span class="nn">.</span><span class="nn">worksheet</span><span class="nn">.</span><span class="nn">pagebreak</span> <span class="kn">import</span> <span class="n">Break</span><span class="p">,</span> <span class="n">PageBreak</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wb</span> <span class="o">=</span> <span class="n">Workbook</span><span class="p">(</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">active</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">_</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="si">{0}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_column_letter</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="p">)</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">col_break</span> <span class="o">=</span> <span class="n">Break</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1">#创建分页符，参数5：在第5/6中间分页</span>
</span></span><span class="line"><span class="cl"><span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="o">.</span><span class="n">tagname</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">rowBreaks</span><span class="s1">&#39;</span> <span class="c1">#分页符属性设置为行分页符</span>
</span></span><span class="line"><span class="cl"><span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_break</span><span class="p">)</span> <span class="c1">#把分页符对象添加到sheet对象里</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">row_break</span> <span class="o">=</span> <span class="n">Break</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">#创建分页符</span>
</span></span><span class="line"><span class="cl"><span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="o">.</span><span class="n">tagname</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">colBreaks</span><span class="s1">&#39;</span> <span class="c1">#分页符属性设置为列分页符</span>
</span></span><span class="line"><span class="cl"><span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_break</span><span class="p">)</span> <span class="c1">#把分页符对象添加到sheet对象里</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">dest_filename</span><span class="p">)</span> 
</span></span></code></pre>
<p>从代码上应该是后面的 page_breaks 把前面的覆盖了, 那让我们看看 page_breaks 究竟是什么东西.</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Worksheet</span><span class="p">(</span><span class="n">_WorkbookChild</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="c1"># 省略部分代码</span>
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">page_breaks</span> <span class="o">=</span> <span class="n">PageBreak</span><span class="p">(</span><span class="p">)</span> <span class="c1"># 再看 PageBreak</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PageBreak</span><span class="p">(</span><span class="n">Serialisable</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">tagname</span> <span class="o">=</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">rowBreaks</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 省略部分代码</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brk</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="sa"></span><span class="s2">&#34;&#34;&#34;</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="s2">        Add a page break</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="s2">        </span><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brk</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">brk</span><span class="p">,</span> <span class="n">Break</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">brk</span> <span class="o">=</span> <span class="n">Break</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brk</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">brk</span> <span class="o">=</span> <span class="n">vals</span>
</span></span></code></pre>
<p>从 example 中我们不难发现,我们是通过修改 page_breaks 的 tag_name 去决定插入的分页符是垂直分页符还是水平分页符的.但是 page_breaks 现在只有一个 PageBreak 这就难怪后声明的会把前面的覆盖了,那么如果我们把 page_breaks 变成 PageBreak 的列表呢?</p>

<h1 id="first-blood-page-breaks">First Blood -- page_breaks</h1>

<p>说改咱就改啊,首先尝试修改 WorkSheet 类</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Worksheet</span><span class="p">(</span><span class="n">_WorkbookChild</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="c1"># 省略部分代码</span>
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">page_breaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">PageBreak</span><span class="p">(</span><span class="p">)</span><span class="p">]</span>
</span></span></code></pre>
<p>然后再修改一下 example.py</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">Workbook</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">openpyxl</span><span class="nn">.</span><span class="nn">compat</span> <span class="kn">import</span> <span class="nb">range</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">openpyxl</span><span class="nn">.</span><span class="nn">utils</span> <span class="kn">import</span> <span class="n">get_column_letter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">openpyxl</span><span class="nn">.</span><span class="nn">worksheet</span><span class="nn">.</span><span class="nn">pagebreak</span> <span class="kn">import</span> <span class="n">Break</span><span class="p">,</span> <span class="n">PageBreak</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wb</span> <span class="o">=</span> <span class="n">Workbook</span><span class="p">(</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dest_filename</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">empty_book.xlsx</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">active</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">_</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="si">{0}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_column_letter</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="p">)</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rowPageBreak</span> <span class="o">=</span> <span class="n">PageBreak</span><span class="p">(</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">rowPageBreak</span><span class="o">.</span><span class="n">tagname</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">rowBreaks</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">colPageBreak</span> <span class="o">=</span> <span class="n">PageBreak</span><span class="p">(</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">colPageBreak</span><span class="o">.</span><span class="n">tagname</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">colBreaks</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">rowPageBreak</span><span class="p">,</span> <span class="n">colPageBreak</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Break</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Break</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">dest_filename</span><span class="p">)</span>
</span></span></code></pre>
<p>敲下回车,心里那个美滋滋,还没高兴几秒钟,就出问题了,果然做人还是得低调一点</p>
<pre class="chroma"><code><span class="line"><span class="cl">Traceback (most recent call last):
</span></span><span class="line"><span class="cl">  File &#34;test.py&#34;, line 24, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    wb.save(filename = dest_filename)
</span></span><span class="line"><span class="cl">  File &#34;F:\workspace\python\test_openpyxl\test_openpyxl\lib\site-packages\openpyxl\workbook\workbook.py&#34;, line 391, in save
</span></span><span class="line"><span class="cl">    save_workbook(self, filename)
</span></span><span class="line"><span class="cl">  File &#34;F:\workspace\python\test_openpyxl\test_openpyxl\lib\site-packages\openpyxl\writer\excel.py&#34;, line 284, in save_workbook
</span></span><span class="line"><span class="cl">    writer.save(filename)
</span></span><span class="line"><span class="cl">  File &#34;F:\workspace\python\test_openpyxl\test_openpyxl\lib\site-packages\openpyxl\writer\excel.py&#34;, line 266, in save
</span></span><span class="line"><span class="cl">    self.write_data()
</span></span><span class="line"><span class="cl">  File &#34;F:\workspace\python\test_openpyxl\test_openpyxl\lib\site-packages\openpyxl\writer\excel.py&#34;, line 83, in write_data
</span></span><span class="line"><span class="cl">    self._write_worksheets()
</span></span><span class="line"><span class="cl">  File &#34;F:\workspace\python\test_openpyxl\test_openpyxl\lib\site-packages\openpyxl\writer\excel.py&#34;, line 203, in _write_worksheets
</span></span><span class="line"><span class="cl">    xml = ws._write()
</span></span><span class="line"><span class="cl">  File &#34;F:\workspace\python\test_openpyxl\test_openpyxl\lib\site-packages\openpyxl\worksheet\worksheet.py&#34;, line 893, in _write
</span></span><span class="line"><span class="cl">    return write_worksheet(self)
</span></span><span class="line"><span class="cl">  File &#34;F:\workspace\python\test_openpyxl\test_openpyxl\lib\site-packages\openpyxl\writer\worksheet.py&#34;, line 151, in write_worksheet
</span></span><span class="line"><span class="cl">    xf.write(ws.page_breaks.to_tree())
</span></span><span class="line"><span class="cl">AttributeError: &#39;list&#39; object has no attribute &#39;to_tree&#39;
</span></span></code></pre>
<p>看了一眼错误信息,发现了从中作祟的家伙再 worksheet.py 的 151 行, 让我们悄悄地看一眼,打枪的不要.</p>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="c1"># worksheet.py</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 省略部分代码</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">xf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="o">.</span><span class="n">to_tree</span><span class="p">(</span><span class="p">)</span><span class="p">)</span>
</span></span></code></pre>
<p>原来是我们修改了 page_breaks 之后, page_breaks 有时候不再是孤家寡人了,我们需要考虑它有另外的 PageBreak 的情况了.</p>

<h1 id="double-kill-worksheet">Double Kill -- Worksheet</h1>
<pre class="chroma"><code><span class="line"><span class="cl"><span class="c1"># worksheet.py</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 省略部分代码</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">for</span> <span class="n">page_break_item</span> <span class="ow">in</span> <span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">xf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">page_break_item</span><span class="o">.</span><span class="n">to_tree</span><span class="p">(</span><span class="p">)</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">xf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">page_breaks</span><span class="o">.</span><span class="n">to_tree</span><span class="p">(</span><span class="p">)</span><span class="p">)</span>
</span></span></code></pre>
<p>回车,毫无问题,人生啊就是这么寂寞如雪~~~</p>

<h1 id="后记">后记</h1>

<p>已经在 openpyxl 提了相应的issue,目前再写测试用例,过段时间就提交 PR 了</p>

            </div>
            
            <div class="tag-list">
                
            </div>
            
            <div class="giscus">
                <script src="https://giscus.app/client.js"
                    data-repo="leetaogoooo/discussion-blog"
                    data-repo-id="R_kgDOIOm9Yg"
                    data-mapping="number"
                    data-term="218"
                    data-reactions-enabled="1"
                    data-emit-metadata="0"
                    data-input-position="top"
                    data-theme="light"
                    data-lang="en"
                    crossorigin="anonymous"
                    async>
                </script>
            </div>
            
        </article>
    </main>
    
    <footer>
        <p>&copy; Leetao. All rights reserved.</p>
    </footer>
    
    <script src="/js/theme-toggle.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            const giscusScript = document.querySelector('script[src^="https://giscus.app/client.js"]');
            const setGiscusTheme = (theme) => {
                if (giscusScript) {
                    const message = { setConfig: { theme: theme } };
                    const iframe = document.querySelector('.giscus-frame');
                    if (iframe) {
                        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
                    }
                }
            };
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            setGiscusTheme(currentTheme);
            new MutationObserver((mutations) => {
                mutations.forEach(mutation => {
                    if (mutation.attributeName === 'data-theme') {
                        setGiscusTheme(mutation.target.getAttribute('data-theme'));
                    }
                });
            }).observe(document.documentElement, { attributes: true });


            
            function initCopyButtons() {
                document.querySelectorAll('pre.chroma').forEach((pre) => {
                    
                    const existingButton = pre.querySelector('.copy-button');
                    if (existingButton) {
                        existingButton.remove();
                    }
                    
                    const button = document.createElement('button');
                    button.className = 'copy-button';
                    button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                    
                    pre.style.position = 'relative';
                    pre.appendChild(button);
                    
                    button.addEventListener('click', () => {
                        const code = pre.querySelector('code');
                        if (code) {
                            navigator.clipboard.writeText(code.innerText).then(() => {
                                button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"></path></svg>';
                                setTimeout(() => {
                                    button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                                }, 2000);
                            });
                        }
                    });
                });
                const button = document.createElement('button');
                button.className = 'copy-button';
                button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                
                pre.style.position = 'relative';
                pre.appendChild(button);
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code');
                    if (code) {
                        navigator.clipboard.writeText(code.innerText).then(() => {
                            button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"></path></svg>';
                            setTimeout(() => {
                                button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
                            }, 2000);
                        });
                    }
                });
            }
            
            
            initCopyButtons();
            
            
            document.addEventListener('themeChanged', () => {
                initCopyButtons();
            });
        });
    </script>
</body>
</html>